{"componentChunkName":"component---src-templates-tags-jsx","path":"/tag/testing","result":{"data":{"site":{"siteMetadata":{"title":"Ken Powers"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"posts":[{"html":"<p><a href=\"https://vuejs.org/\" title=\"Vue.js\">Vue</a> is a progressive framework for building user interfaces in JavaScript,\nHTML, and CSS. One of its most unique features is that it allows you to combine\nthe JavaScript (logic), HTML (template), and CSS (style) for a single component\ninto a <a href=\"https://vuejs.org/v2/guide/single-file-components.html\" title=\"Single File Components\">single <code class=\"language-text\">.vue</code> file</a>.</p>\n<p>One of the benefits of writing universal JavaScript is that you can test all of\nyour code, front-end and back-end, together in node without having to spin up\nbrowser processes. Unfortunately, <code class=\"language-text\">.vue</code> files don't quite fit this pattern.\nUntil now.</p>\n<p>I just published version <code class=\"language-text\">1.0.0</code> of <a href=\"https://github.com/knpwrs/vue-node\" title=\"vue-node: A require hook for loading single-file vue components in node.\"><code class=\"language-text\">vue-node</code></a>, a require hook for loading\nsingle-file vue components in node. What follows is an example of how to use\n<a href=\"https://github.com/knpwrs/vue-node\" title=\"vue-node: A require hook for loading single-file vue components in node.\"><code class=\"language-text\">vue-node</code></a> with <a href=\"https://github.com/avajs/ava\" title=\"AVA: Futuristic Test Runner\">AVA</a>, a popular node testing framework.</p>\n<h2>Let's do this!</h2>\n<p>First, make sure you have <a href=\"https://github.com/knpwrs/vue-node\" title=\"vue-node: A require hook for loading single-file vue components in node.\"><code class=\"language-text\">vue-node</code></a> and <a href=\"https://github.com/lukechilds/browser-env\"><code class=\"language-text\">browser-env</code></a> installed as\ndevelopment dependencies. If you are running an environment with <code class=\"language-text\">vue-loader</code>\nand <code class=\"language-text\">webpack@2</code> then you will already have all required peer dependencies:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">npm i -D vue-node browser-env</code></pre></div>\n<p>Now create a setup file called <code class=\"language-text\">test/helpers/setup.js</code>. Putting it in the\n<code class=\"language-text\">test/helpers</code> directory will let <a href=\"https://github.com/avajs/ava\" title=\"AVA: Futuristic Test Runner\">AVA</a> know that this file is not a test.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> browserEnv <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'browser-env'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> hook <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'vue-node'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> join <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Setup a fake browser environment</span>\n<span class=\"token function\">browserEnv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Pass an absolute path to your webpack configuration to the hook function.</span>\n<span class=\"token function\">hook</span><span class=\"token punctuation\">(</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'webpack.config.test.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now you can configure AVA to require this file in all test processes. In\n<code class=\"language-text\">package.json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"ava\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"require\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"./test/helpers/setup.js\"</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now you can <code class=\"language-text\">require</code> / <code class=\"language-text\">import</code> <code class=\"language-text\">.vue</code> files and test like you would in a\nbrowser! If you need to test DOM updates, I recommend using the <a href=\"https://github.com/sindresorhus/p-immediate\" title=\"Returns a promise resolved in the next event loop\"><code class=\"language-text\">p-immediate</code></a>\npackage from npm along with <code class=\"language-text\">async</code> / <code class=\"language-text\">await</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> Vue <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> test <span class=\"token keyword\">from</span> <span class=\"token string\">'ava'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> nextTick <span class=\"token keyword\">from</span> <span class=\"token string\">'p-immediate'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> TestComponent <span class=\"token keyword\">from</span> <span class=\"token string\">'./test.vue'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'renders the correct message'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">t</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> Constructor <span class=\"token operator\">=</span> Vue<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span>TestComponent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> vm <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">$mount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  t<span class=\"token punctuation\">.</span><span class=\"token function\">is</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'h1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">,</span> <span class=\"token string\">'Hello, World!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Update</span>\n  vm<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">nextTick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  t<span class=\"token punctuation\">.</span><span class=\"token function\">is</span><span class=\"token punctuation\">(</span>vm<span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'h1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">,</span> <span class=\"token string\">'Hello, Foo!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>There are more examples in the <a href=\"https://github.com/knpwrs/vue-node/tree/master/test\"><code class=\"language-text\">test</code> directory</a> of <a href=\"https://github.com/knpwrs/vue-node\" title=\"vue-node: A require hook for loading single-file vue components in node.\"><code class=\"language-text\">vue-node</code></a>.</p>\n<h2>How does this work?</h2>\n<p>Node allows developers to hook <code class=\"language-text\">require</code> to load files that aren't JavaScript or\nJSON. Unfortunately, require hooks have to be synchronous. Using <code class=\"language-text\">vue-loader</code> on\nthe other hand, is inherently asynchronous. <a href=\"https://github.com/knpwrs/vue-node\" title=\"vue-node: A require hook for loading single-file vue components in node.\"><code class=\"language-text\">vue-node</code></a> works by synchronously\nrunning webpack in a separate process and collecting the output to pass to\nnode's module compilation system. The compilation is done completely in memory\nwithout writing to the filesystem. It also modifies your webpack configuration\nto automatically build for node and commonjs with all dependencies of your\ncomponent externalized. This means that the built component modules are as small\nas possible with dependency resolution left up to node.</p>\n<h2>Why not just test in browsers using Karma?</h2>\n<p>Unit testing in web browsers is a very heavy process with many tradeoffs.\nConfiguration and tooling is tricky as is getting browsers to run in CI. I\npersonally like saving browsers for end-to-end testing with things like\n<a href=\"http://nightwatchjs.org/\" title=\"Node.js powered End-to-End testing framework\"><code class=\"language-text\">Nightwatch.js</code></a>.</p>\n<h2>What if I use vueify?</h2>\n<p>I am personally more familiar with webpack than browserify, so for the time\nbeing this will only work in combination with webpack. I will gladly accept a\npull request to implement browserify functionality.</p>\n<h2>Don't <code class=\"language-text\">.vue</code> files violate the principle of separation of concerns?</h2>\n<p>No. For the same reason React doesn't violate that very same principle for\nputting angle brackets in your JavaScript. Separation of technologies is often\nconfused with separation of concerns. Far from separating your concerns, using\nseparate files just spreads out your concerns and makes them hard to manage.</p>\n<h2>What now?</h2>\n<p>Use <a href=\"https://github.com/knpwrs/vue-node\" title=\"vue-node: A require hook for loading single-file vue components in node.\"><code class=\"language-text\">vue-node</code></a> in your projects and submit issues and pull requests. I would\nlove to see the <a href=\"https://vuejs.org/\" title=\"Vue.js\">Vue</a> community embrace headless testing in node just like the\nReact community has. Feel free to leave any questions or feedback in the\ncomments section below.</p>","id":"27431db9-42f2-56c1-9b86-a51249d9c7ef","timeToRead":3,"frontmatter":{"date":"February 11, 2017","path":"/blog/testing-vue-in-node","tags":"vue, testing","title":"Testing Single-File Vue Components in Node"}},{"html":"<p>In <a href=\"/blog/testing-in-browsers-and-node/\" title=\"Testing in Browsers and Node with Mocha, Chai, Sinon, and Testem\">my previous post on testing</a> I covered the basics of testing with\n<a href=\"http://visionmedia.github.io/mocha/\" title=\"Mocha\">Mocha</a>, <a href=\"http://chaijs.com/\" title=\"Chai\">Chai</a>, and <a href=\"http://sinonjs.org/\" title=\"Sinon.JS\">Sinon</a> -- including asynchronous\ntesting and stubbing methods with asynchronous callbacks (such as methods\nwhich make a server request). That's all well and good, but sometimes it's\nmore convenient or natural to synchronously manipulate the JavaScript timer or\ncreate fake servers to instantly and synchronously respond to requests.\n<a href=\"http://sinonjs.org/\" title=\"Sinon.JS\">Sinon</a> provides the facilities to work such magic -- read on to learn\nmore.</p>\n<h2>Fake Timers</h2>\n<p>If you are testing code which uses <code class=\"language-text\">setTimeout</code> or <code class=\"language-text\">setInterval</code> it can be\ntricky to get the asynchronous test right and if your timeouts are of any\nsubstantial length your tests can take longer than ideal to complete. Sinon\nlets us replace the global <code class=\"language-text\">setTimeout</code> and <code class=\"language-text\">setInterval</code> functions with fake\nversions that we can control. Observe:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fake timers'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Overwrite the global timer functions (setTimeout, setInterval) with Sinon fakes</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">useFakeTimers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">afterEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Restore the global timer functions to their native implementations</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should synchronously advance the JavaScript clock'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Create a spy to record all calls</span>\n    <span class=\"token keyword\">var</span> spy <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Call the spy in 1000ms</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Tick the clock forward 999ms</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">.</span><span class=\"token function\">tick</span><span class=\"token punctuation\">(</span><span class=\"token number\">999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// The spy should not have been called yet</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>called<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Tick the clock forward 1ms</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">.</span><span class=\"token function\">tick</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Now the spy should have been called</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>called<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should also work with setInterval'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Faking the JavaScript clock also works with setInterval:</span>\n    <span class=\"token keyword\">var</span> spy <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">.</span><span class=\"token function\">tick</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>calledTwice<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">.</span><span class=\"token function\">tick</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>calledThrice<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>When we call <code class=\"language-text\">sinon.useFakeTimers()</code> Sinon replaces the global <code class=\"language-text\">setTimeout</code>\nand <code class=\"language-text\">setInterval</code> functions and returns a clock object we can control. By\ncalling <code class=\"language-text\">clock.tick(n)</code> we are able to advance the clock by <code class=\"language-text\">n</code> milliseconds.\nWhen the milliseconds we have ticked forward are greater than or equal to the\ndelay parameter given to a timeout or interval the respective callbacks are\ncalled synchronously. In our case the callback is a Sinon spy which we are\nable to examine for call details when we need to make assertions.</p>\n<h2>Ensuring Spy Call Order</h2>\n<p>Spies are capable of determining the order they were called relative to each\nother. We can demonstrate this by testing that a number of timeouts were\ntriggered in the proper order:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should be able to verify call order'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Create some spies</span>\n  <span class=\"token keyword\">var</span> spy1 <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> spy2 <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Set some timeouts</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>spy1<span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>spy2<span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Advance the clock</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">.</span><span class=\"token function\">tick</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Expectations</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>called<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>called<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">calledBefore</span><span class=\"token punctuation\">(</span>spy2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>I am using <code class=\"language-text\">sinon-chai</code> but you can also verify call order using\n<code class=\"language-text\">spy.calledBefore(otherSpy)</code> and <code class=\"language-text\">spy.calledAfter(otherSpy)</code>.</p>\n<h2>Fake Requests</h2>\n<p>On to faking <code class=\"language-text\">XMLHttpRequest</code>! Sinon allows us to override the global\n<code class=\"language-text\">XMLHttpRequest</code> object and synchronously control its behavior. Consider the\nfollowing:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fake requests'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Overwrite the global XMLHttpRequest with Sinon fakes</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>xhr <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">useFakeXMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Create an array to store requests</span>\n    <span class=\"token keyword\">var</span> requests <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requests <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Keep references to created requests</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>xhr<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">xhr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      requests<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">afterEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Restore the global timer functions to their native implementations</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>xhr<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake XMLHttpRequests'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Create a spy</span>\n    <span class=\"token keyword\">var</span> spy <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Request using jQuery</span>\n    $<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/foo/bar/baz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Verify that the request is tracked -- not really necessary, just a demonstration</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requests<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>have<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Respond to the request</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>requests<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">respond</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// The spy was called synchrnously, verify its call details.</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">calledWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Before each test we set up the fake <code class=\"language-text\">XMLHttpRequest</code> and override <code class=\"language-text\">onCreate</code>\nso that we may track all requests we make using it. After each test we restore\nthe native <code class=\"language-text\">XMLHttpRequest</code> object. In the actual test we make a request with\njQuery, make sure the proper number of requests were sent, and then respond to\nthe request with headers and data which causes jQuery to synchronously call a\nspy we set up.</p>\n<p>Cool stuff, but shouldn't there be an easier way to accomplish all of this\nwithout having to keep track of requests? Read on to learn about fake servers\nin Sinon.</p>\n<h2>Fake Servers</h2>\n<p>Fake servers in Sinon are an extension of fake requests which keep track of\nrequests for us so we don't have to! Fake servers work very similarly to fake\nrequests, as such:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fake servers'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Set up a fake server (calls `sinon.useFakeXMLHttpRequest()`)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span>fakeServer<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">afterEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Create a spy to record server responses.</span>\n    <span class=\"token keyword\">var</span> spy <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Request with jQuery</span>\n    $<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/foo/bar/baz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">always</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// MAKE SURE YOU CALL `server.respond()`!</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respond</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Make assertions, onces again, everything is synchronous.</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>calledOnce<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">calledWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Restore native functionality.</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake server responses (basic response)'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake server responses (url, response)'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/foo/bar/baz'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake server responses (url regex, response)'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/\\/foo\\/bar\\/baz$/</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake server responses (method, url, response)'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/foo/bar/baz'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake server responses (method, url regex, response)'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token regex\">/\\/foo\\/bar\\/baz$/</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake server responses (method, url, [code, headers, response])'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/foo/bar/baz'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should fake server responses (method, url regex, [code, headers, response])'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token regex\">/\\/foo\\/bar\\/baz$/</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FooBarBaz!'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Here we have seven tests which all have the same assertions. For that reason,\nI put the assertions in the <code class=\"language-text\">afterEach</code> hook. The basic flow of using fake\nservers is as such:</p>\n<ul>\n<li><strong>Before Each:</strong> Create a fake server, overriding native functionality.</li>\n<li><strong>Test:</strong> Tell the fake server how to respond to requests with\n<code class=\"language-text\">server.respondWith(...)</code>.</li>\n<li><strong>Test:</strong> Make requests using your favorite method.</li>\n<li><strong>Test:</strong> Tell the fake server to synchronously respond with\n<code class=\"language-text\">server.respond()</code>.</li>\n<li><strong>After Each:</strong> Restore native functionality.</li>\n</ul>\n<p>The reason I have seven tests is to demonstrate all the different ways you can\nhave a server respond to requests by using the different signatures of\n<code class=\"language-text\">server.respondWith(...)</code>. In order, each of the tests do the following:</p>\n<ol>\n<li>Respond to all requests with the same plain text.</li>\n<li>Respond to all requests with a specific url.</li>\n<li>Respond to all requests to an url matching a given regular expression.</li>\n<li>Respond to all <code class=\"language-text\">GET</code> requests to a specific url.</li>\n<li>Respond to all <code class=\"language-text\">GET</code> requests to an url matching a given regular\nexpression.</li>\n<li>Respond to all <code class=\"language-text\">GET</code> requests to a specific url with custom headers.</li>\n<li>Respond to all <code class=\"language-text\">GET</code> requests to an url matching a given regular expression\nwith custom headers.</li>\n</ol>\n<p>As you can see, fake servers are extremely flexible and are capable of\ncompletely decoupling your front-end tests from your back end enabling you to\nnot have to run a server for your tests. This, of course, can be accomplished\nwith regular stubbing, but the fake server approach is often simpler and more\nnatural.</p>\n<h2>JSON-P</h2>\n<p>As of this writing, Sinon doesn't support fake JSON-P requests and it probably\nnever will. The official recommendation is to fall back to stubbing whenever\nyou need to make a JSON-P request. For more information, check out <a href=\"http://sinonjs.org/docs/#json-p\" title=\"Sinon JSON-P Workaround\">the\nofficial documentation</a>.</p>\n<h2>Conclusion</h2>\n<p>By using advanced features provided by <a href=\"http://sinonjs.org/\" title=\"Sinon.JS\">Sinon</a> we are able to simplify\nand even drastically improve the performance of tests which rely on\n<code class=\"language-text\">setTimeout</code>, <code class=\"language-text\">setInterval</code>, and making requests for external resources. To\nlearn more, be sure to check out <a href=\"http://sinonjs.org/docs/\" title=\"Sinon.JS Official Documentation\">Sinon's Official Documentation</a>.</p>","id":"c401a26a-29b7-5716-a687-96f17ff9557e","timeToRead":6,"frontmatter":{"date":"January 01, 2014","path":"/blog/advanced-features-in-sinon","tags":"javascript, testing","title":"Advanced Features in Sinon"}},{"html":"<p>So you're writing some JavaScript code that has to run in multiple web\nbrowsers as well as Node. How can you effectively test this code? Effective\ntesting means that you should be able to run all tests in all environments on\ndemand, i.e., with the press of a single button the tests should run in Node,\nChrome, Firefox, Internet Explorer, and whatever other environments you have\nset up for testing, and we should avoid code duplication whenever possible.\nContinue reading and I'll walk you through setting up a basic testing\nenvironment using <a href=\"http://visionmedia.github.io/mocha/\" title=\"Mocha\">Mocha</a> as a testing framework, <a href=\"http://chaijs.com/\" title=\"Chai\">Chai</a> for\nassertions, <a href=\"http://sinonjs.org/\" title=\"Sinon\">Sinon</a> for mocking, and <a href=\"https://github.com/airportyh/testem\" title=\"Testem\">Testem</a> as a universal\ntest runner. Basic knowledge of testing, asserting, and mocking in languages\nother than JavaScript is assumed. Those of you who are familiar with testing,\nasserting, and mocking in JavaScript will want to <a href=\"#testem\">skip to the\nTestem</a> section below -- that's where the meat and potatoes of\npulling everything together into a working example is.</p>\n<h2>Mocha</h2>\n<p><a href=\"http://visionmedia.github.io/mocha/\" title=\"Mocha\">Mocha</a> is a testing framework for JavaScript which provides a\nflexible, intuitive, and consistent interface for testing JavaScript code,\nboth synchronous and asynchronous. Additionally, it is designed to run in both\nmajor browsers and Node.</p>\n<p>Without further to do, a basic test suite looks like the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Library Tests'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// set up the environment</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Should add numbers'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// make assertions</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The above code should be fairly self-explanatory. <code class=\"language-text\">describe</code> is used to\ndescribe a test suite, and <code class=\"language-text\">it</code> is used to define actual tests. I am also\nmaking use of a <code class=\"language-text\">before</code> hook to set up the environment prior to running any\ntests. In addition to the <code class=\"language-text\">before</code> hook, Mocha makes available the <code class=\"language-text\">after</code>\nhook, which executes after all tests have run. The <code class=\"language-text\">before</code> and <code class=\"language-text\">after</code> hooks\nadditionally have <code class=\"language-text\">beforeEach</code> and <code class=\"language-text\">afterEach</code> counterparts, which, as their\nnames imply, rather than running before or after all tests run before and\nafter each individual test.</p>\n<h3>Asynchronous Testing</h3>\n<p>One of the advantages of using Mocha as opposed to certain other testing\nframeworks is that it makes asynchronous testing really easy. Consider the\nfollowing test:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should foobar'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Simulate calling an asynchronous method with `setTimeout`</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Make assertions</span>\n    <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The only change to the test is that the <code class=\"language-text\">it</code> function now accepts a <code class=\"language-text\">done</code>\nargument. <code class=\"language-text\">done</code> is a function you should call when the test has completed\n(after all assertions). Additionally, <code class=\"language-text\">done</code> accepts an <code class=\"language-text\">Error</code> object as its\nfirst argument if you have one to give it. The previously mentioned <code class=\"language-text\">before</code>,\n<code class=\"language-text\">beforeEach</code>, <code class=\"language-text\">after</code>, and <code class=\"language-text\">afterEach</code> hooks can also be set up to run\nasynchronously in the same fashion:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'async tests'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Before Hooks</span>\n  <span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Tests</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should foo'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should bar'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// After Hooks</span>\n  <span class=\"token function\">afterEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">after</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The above code will take approximately 8 seconds to run and will follow a\nserial execution path as such:</p>\n<ul>\n<li><code class=\"language-text\">before</code></li>\n<li><code class=\"language-text\">beforeEach</code></li>\n<li><code class=\"language-text\">it</code> should foo</li>\n<li><code class=\"language-text\">afterEach</code></li>\n<li><code class=\"language-text\">beforeEach</code></li>\n<li><code class=\"language-text\">it</code> should bar</li>\n<li><code class=\"language-text\">afterEach</code></li>\n<li><code class=\"language-text\">after</code></li>\n</ul>\n<p>Of course, you can mix synchronous and asynchronous hooks and tests and\neverything will run serially with no extra effort.</p>\n<p>You may have noticed that I haven't been making any assertions. That is\nbecause Mocha is designed to let you use your own assertions library. Node\nprovides an <code class=\"language-text\">assert</code> module, but we want to use the same tests and assertions\nin all of our environments, not just Node. This is where <a href=\"http://chaijs.com/\" title=\"Chai\">Chai</a> comes\nin.</p>\n<h2>Chai</h2>\n<p><a href=\"http://chaijs.com/\" title=\"Chai\">Chai</a> is an assertions library which provides multiple styles of\nassertions for your to use as you see fit. I prefer\n<a href=\"http://chaijs.com/api/bdd/\"><code class=\"language-text\">expect</code></a>-style assertions which read like\nsentences. See the following examples:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token string\">'three'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>deep<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">instanceOf</span><span class=\"token punctuation\">(</span>Error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token string\">'string'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>As you can see, the <code class=\"language-text\">expect</code> style of assertions are very readable and even\nself-documenting. The lack of parentheses after <code class=\"language-text\">true</code> in <code class=\"language-text\">to.be.true</code> is not\na mistake. Chai's <code class=\"language-text\">expect</code> style makes use of <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Working_with_Objects#Defining_getters_and_setters\" title=\"Defining Getters and Setters\">JavaScript getters and\nsetters</a> meaning <code class=\"language-text\">to.be.true</code> is not a function, but a property getter.\nIf you need to support an environment which does not support getters and\nsetters, you will have to use <code class=\"language-text\">to.equal(true)</code> or another assertions library\nwhich is purely functional.</p>\n<p>Obviously, the above sample does not cover everything you can do in Chai.\nThere is a <a href=\"http://chaijs.com/api/bdd/\" title=\"Chai BDD API\">list of all available chains and assertions</a> available\nthrough <a href=\"http://chaijs.com/\" title=\"Chai\">Chai's documentation</a>. The assertions provided by Chai cover\neverything you may want to assert, including (deep) (in)equality, inclusion,\nexistence, ranges, regular expression matching, and (static) method\nrespondence. Additional functionality which extends the core of Chai is\navailable in community-provided <a href=\"http://chaijs.com/plugins\" title=\"Chai Plugins\">plugins</a>.</p>\n<h2>Sinon</h2>\n<p>On to everybody's favorite topic: mocking! <a href=\"http://sinonjs.org/\" title=\"Sinon\">Sinon</a> is a library which\nprovides spies, stubs, and mocks for JavaScript. Let's cover each of those in\norder.</p>\n<h3>Spies</h3>\n<p>A <a href=\"http://sinonjs.org/docs/#spies\" title=\"Sinon Spies API\"><code class=\"language-text\">spy</code></a> is a function which automatically records various metrics\nregarding its execution including arguments passed to it, return value, the\nvalue of <code class=\"language-text\">this</code>, and any exceptions thrown for all of its calls. See the\nfollowing example:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> func <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">func</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">.</span>called<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// The following two assertions are identical</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">.</span>calledOnce<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">.</span>callCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// The following two assertions are identical</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">.</span>firstCall<span class=\"token punctuation\">.</span><span class=\"token function\">calledWith</span><span class=\"token punctuation\">(</span>sinon<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">.</span>number<span class=\"token punctuation\">,</span> sinon<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">.</span><span class=\"token function\">getCall</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">calledWith</span><span class=\"token punctuation\">(</span>sinon<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">.</span>number<span class=\"token punctuation\">,</span> sinon<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// You can even verify that a function was called with specific arguments (not just types)</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">.</span>firstCall<span class=\"token punctuation\">.</span><span class=\"token function\">calledWith</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>As you can see, Sinon spies are extremely flexible. This example only begins\nto scratch the surface of spies in Sinon. <code class=\"language-text\">calledOnce</code> is accompanied by\n<code class=\"language-text\">calledTwice</code> and <code class=\"language-text\">calledThrice</code> which are all aliases for checking the\n<code class=\"language-text\">callCount</code>. In addition to <code class=\"language-text\">firstCall</code>, Sinon spies provide <code class=\"language-text\">secondCall</code> and\n<code class=\"language-text\">thirdCall</code> properties which are all aliases for <code class=\"language-text\">getCall(0)</code>, <code class=\"language-text\">getCall(1)</code>,\nand <code class=\"language-text\">getCall(2)</code>, respectively. Anything beyond the third call must be\naccessed with <code class=\"language-text\">getCall(n)</code> where <code class=\"language-text\">n</code> is the number call you want to access.\nCalls can additionally be inspected, in this case to make sure they were\ncalled with a <code class=\"language-text\">number</code> and a <code class=\"language-text\">string</code>. Sinon provides even more matchers for\nthe following situations:</p>\n<ul>\n<li>All basic JavaScript primitives</li>\n<li>Truthy / falsy values</li>\n<li>Referential equality to a given object</li>\n<li>Making sure an argument is an instance of a particular constructor</li>\n<li>Making sure an argument has a property (or its own property) which\noptionally match additional expectations</li>\n</ul>\n<p>Matchers can even be combined; for example, you can check to make sure an\nargument is either a <code class=\"language-text\">string</code> or a <code class=\"language-text\">number</code>. To learn more about this\nfunctionality check out Sinon's <a href=\"http://sinonjs.org/docs/#sinon-match\" title=\"Sinon Matchers API\">matchers documentation</a>.</p>\n<p>Spies can wrap themselves around existing methods on existing methods.\nConsider the following example utilizing <a href=\"http://jquery.com\" title=\"jQuery\">jQuery</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Spy on the `ajax` method of the `jQuery` object</span>\nsinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span>jQuery<span class=\"token punctuation\">,</span> <span class=\"token string\">'ajax'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Call `jQuery.get(...)` which calls `jQuery.ajax` down the chain</span>\njQuery<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/some/resource'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Assert that `jQuery.ajax` was called with the given url.</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>jQuery<span class=\"token punctuation\">.</span>ajax<span class=\"token punctuation\">.</span>calledOnce<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>jQuery<span class=\"token punctuation\">.</span>ajax<span class=\"token punctuation\">.</span><span class=\"token function\">getCall</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/some/resource'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Unwrap `jQuery.ajax` so other tests will be unaffected and can get up their own spies</span>\njQuery<span class=\"token punctuation\">.</span>ajax<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In this example I referenced the passed argument directly and checked a\nproperty on it for equality to what was passed. I also called the <code class=\"language-text\">restore()</code>\nmethod on the spy to return <code class=\"language-text\">jQuery.ajax</code> to its original functionality. This\nis an important step in testing (often run in <code class=\"language-text\">after</code> or <code class=\"language-text\">afterEach</code> hooks) to\nmake sure tests and their spies do not interfere with each other.</p>\n<p>For more information on spy functionality in Sinon, including verifying order\nof calls to multiple spies, check out the <a href=\"http://sinonjs.org/docs/#spies\" title=\"Sinon Spies API\">Sinon spy documentation</a>.</p>\n<h3>Stubs</h3>\n<p>A <a href=\"http://sinonjs.org/docs/#stubs\" title=\"Sinon Stubs API\"><code class=\"language-text\">stub</code></a> is a <a href=\"http://sinonjs.org/docs/#spies\" title=\"Sinon Spies API\"><code class=\"language-text\">spy</code></a> with pre-programmed functionality. You\nshould use a stub when you need to control the behavior of a function you are\nspying on. You can very easily program a stub to throw an exception, return a\ngiven value, return and argument which was passed to it, or even call an\nargument which was passed to it -- with or without arguments, synchronously or\nasynchronously. Stubs can even be programmed to do different things when\ndifferent arguments are passed to them. Consider the following example:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> func <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">stub</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfunc<span class=\"token punctuation\">.</span><span class=\"token function\">withArgs</span><span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">returns</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfunc<span class=\"token punctuation\">.</span><span class=\"token function\">throws</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">func</span><span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">throw</span><span class=\"token punctuation\">(</span>Error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>When <code class=\"language-text\">func</code> is passed <code class=\"language-text\">42</code>, it will return <code class=\"language-text\">1</code>. Otherwise, it will throw an\nexception.</p>\n<p>Just like how you can spy on methods of objects, you can stub methods of\nobjects. Consider the following example of stubbing the <code class=\"language-text\">readFile</code> method on\nNode's filesystem module:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Stub the file system module</span>\nsinon<span class=\"token punctuation\">.</span><span class=\"token function\">stub</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">,</span> <span class=\"token string\">'readFile'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Asynchronously call the third argument with a null error and some text when passed certain arguments</span>\nfs<span class=\"token punctuation\">.</span>readFile\n  <span class=\"token punctuation\">.</span><span class=\"token function\">withArgs</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">,</span> sinon<span class=\"token punctuation\">.</span>matchers<span class=\"token punctuation\">.</span>func<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">callsArgWithAsync</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Foo!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Asynchronously call the third argument with an error when passed certain arguments</span>\nfs<span class=\"token punctuation\">.</span>readFile\n  <span class=\"token punctuation\">.</span><span class=\"token function\">withArgs</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">,</span> sinon<span class=\"token punctuation\">.</span>matchers<span class=\"token punctuation\">.</span>func<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">callsArgWithAsync</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'File not found!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Do your testing</span>\n<span class=\"token comment\">// Afterwards make sure you restore `fs.readFile` to its original functionality.</span>\nfs<span class=\"token punctuation\">.</span>readFile<span class=\"token punctuation\">.</span><span class=\"token function\">restore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now everything that calls <code class=\"language-text\">fs.readFile(&#39;foo.txt&#39;, &#39;utf8&#39;, callback)</code> will have\n<code class=\"language-text\">callback</code> called with <code class=\"language-text\">null</code> for an error and <code class=\"language-text\">&#39;Foo!&#39;</code> for data and\neverything that calls <code class=\"language-text\">fs.readFile(&#39;bar.txt&#39;, &#39;utf8&#39;, callback)</code> will have\n<code class=\"language-text\">callback</code> called with an <code class=\"language-text\">Error</code> object. The <code class=\"language-text\">callback</code>s are called\nasynchronously so all other functionality of your program is preserved, but\nyour tests are no longer dependent on the file system. Stubbing methods which\nrely on external resources such as file systems or network connections is very\ncommon in testing as your tests will run faster and will be more portable\noverall.</p>\n<p>To learn more about Sinon stubs, read the <a href=\"http://sinonjs.org/docs/#stubs\" title=\"Sinon Stubs API\">Sinon stub documentation</a>.</p>\n<h3>Mocks</h3>\n<p><a href=\"http://sinonjs.org/docs/#mocks\" title=\"Sinons Mocks API\">Mocks</a> provide fake methods with pre-programmed functionality and with\npre-programmed expectations. For example, you can program a mock to expect a\ncertain number of calls, at most a certain number of calls, at least a certain\nnumber of calls, to never be called, to be called with certain arguments, and\nmore. After your test is done you can call your mock's <code class=\"language-text\">verify</code> method which\nwill throw an exception if the preset expectations are not met. To learn more\nabout mocks and expectations in Sinon you can read <a href=\"http://sinonjs.org/docs/#mocks\" title=\"Sinons Mocks API\">Sinon's mock\ndocumentation</a>.</p>\n<h3>Chai Assertions</h3>\n<p>Sinon provides its own assertions. Despite this, for the sake of consistency,\nI was using Chai assertions in the examples above. There is a plugin available\nfor Chai which can streamline expectations for Sinon spies, stubs, and mocks.\nUsing the plugin, my first Sinon example from above would look like the\nfollowing:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> func <span class=\"token operator\">=</span> sinon<span class=\"token punctuation\">.</span><span class=\"token function\">spy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">func</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>have<span class=\"token punctuation\">.</span>been<span class=\"token punctuation\">.</span>called<span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>have<span class=\"token punctuation\">.</span>been<span class=\"token punctuation\">.</span>calledOnce<span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>have<span class=\"token punctuation\">.</span>been<span class=\"token punctuation\">.</span><span class=\"token function\">calledWith</span><span class=\"token punctuation\">(</span>sinon<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">.</span>number<span class=\"token punctuation\">,</span> sinon<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">.</span>string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>have<span class=\"token punctuation\">.</span>been<span class=\"token punctuation\">.</span><span class=\"token function\">calledWith</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>For more information, check out the <a href=\"http://chaijs.com/plugins/sinon-chai\" title=\"Sinon-Chai Plugin Documentation\">Sinon-Chai plugin\ndocumentation</a>.</p>\n<h3>More Sinon Functionality</h3>\n<p>Sinon provides a plethora of other features specific to JavaScript including\nfake timers, fake <code class=\"language-text\">XMLHttpRequest</code>s, and fake servers. To learn more about\nthese features take a look at <a href=\"http://sinonjs.org/docs\" title=\"Sinon Official Documentation\">Sinon's official\ndocumentation</a>.</p>\n<h2>Testem</h2>\n<p>This is where we tie everything together. <a href=\"https://github.com/airportyh/testem\" title=\"Testem\">Testem</a> is a test runner\nwhich can automatically run tests in multiple web browsers and other\nenvironments such as Node. By default tests will run when you connect a\nbrowser or other environment and can be rerun in all connected environments\nwith the press of a button. By default, tests are also automatically rerun\nwhen a change is detected on the file system. Testem is even capable of giving\nyou native system notifications meaning you can just code away in your\nfavorite editor and immediately see test results upon saving without having to\ndo anything.</p>\n<p>Testem provides default HTML pages for running and auto-rerunning as well as\ncollecting test results. Setting it up to run tests in Node requires a little\nbit of set up; however, it is entirely worth it, trust me. Once everything is\nset up not only are tests run automatically but all results are collected\ncentrally so you can instantly see what happened where. In order to streamline\nthis process I have made a <a href=\"https://github.com/KenPowers/testing-in-browsers-and-node\" title=\"GitHub Project\">project available on github</a>.</p>\n<p>First, you need to install <a href=\"http://nodejs.org\" title=\"Node\">Node</a>. My preferred method is to use\n<a href=\"https://github.com/creationix/nvm\" title=\"Node Version Manager\">nvm</a> but you can set it up however you like.</p>\n<p>Next, clone the project down to your local workspace, change into the project\ndirectory, and install all dependencies using the following commands:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ git clone https://github.com/KenPowers/testing-in-browsers-and-node.git\n$ cd testing-in-browsers-and-node\n$ npm install</code></pre></div>\n<p>Optionally, you can install Testem and Mocha globally (they are both installed\nlocally as a part of the project, but installing them globally will allow you\nto use them elsewhere):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ npm install -g testem mocha</code></pre></div>\n<p>Be aware that as of the writing of this article, if you are running Windows\nthen you will need to <a href=\"https://github.com/airportyh/testem#known-issues\" title=\"Windows Workaround\">follow one extra step</a>.</p>\n<p>Now we can take a look at how everything works together. First, <code class=\"language-text\">testem.json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"framework\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mocha\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"src_files\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"node_modules/chai/chai.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"lib/*\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"test/setup.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"test/*.test.js\"</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"launchers\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"node\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"command\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./node_modules/.bin/mocha -r test/setup.js -R tap test/*.test.js\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"protocol\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tap\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"launch_in_dev\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"node\"</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Let's walk through this file key-by-key. First we have the <code class=\"language-text\">framework</code> option\nset to <code class=\"language-text\">mocha</code>. This tells Testem to load Mocha into all connected web\nbrowsers. Next we have a <code class=\"language-text\">src_files</code> option. These are the files which are\nmonitored for changes as well as served (in order) to all connected web\nbrowsers. We explicity list <code class=\"language-text\">test/setup.js</code> before <code class=\"language-text\">*.test.js</code> to make sure\nour setup file is served and executed before the tests. Next, we set up\nlaunching tests in Node. This is required because by default Testem just sets\nup a server for browsers to connect to. All we need to do to get Node working\nwith Testem is get it running in a similar setup that the browsers will have.\nThe command <code class=\"language-text\">./node_modules/.bin/mocha -r test/setup.js -R tap test/*.test.js</code>\nruns Mocha (node) telling it to require the file <code class=\"language-text\">test/setup.js</code>, use\n<a href=\"http://en.wikipedia.org/wiki/Test_Anything_Protocol\" title=\"Test Anything Protocol\">tap</a> as the protocol (so Testem can read the results), and run all files\nmatching the pattern <code class=\"language-text\">test/*.test.js</code> as tests. If you have Mocha installed\nglobally then you can simply use <code class=\"language-text\">mocha</code> instead of\n<code class=\"language-text\">./node_modules/.bin/mocha</code>. <em>Finally</em>, <code class=\"language-text\">launch_in_dev</code> tells Testem to run\nour Node launcher.</p>\n<p>Now we just have to take a look at one section of <code class=\"language-text\">package.json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./node_modules/.bin/testem\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With this piece of configuration you can run <code class=\"language-text\">npm test</code> which will run the\nlocal installation of Testem which will read <code class=\"language-text\">testem.json</code> and start running\nthe tests. Alternatively, if you have <code class=\"language-text\">testem</code> installed globally then you can\njust run <code class=\"language-text\">testem</code> directly.</p>\n<p>One last file needs a walk though: <code class=\"language-text\">test/setup.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Export modules to global scope as necessary (only for testing)</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> process <span class=\"token operator\">!==</span> <span class=\"token string\">'undefined'</span> <span class=\"token operator\">&amp;&amp;</span> process<span class=\"token punctuation\">.</span>title <span class=\"token operator\">===</span> <span class=\"token string\">'node'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// We are in node. Require modules.</span>\n  expect <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'chai'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>expect<span class=\"token punctuation\">;</span>\n  sinon <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sinon'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  num <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'..'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  isBrowser <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// We are in the browser. Set up variables like above using served js files.</span>\n  expect <span class=\"token operator\">=</span> chai<span class=\"token punctuation\">.</span>expect<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// num and sinon already exported globally in the browser.</span>\n  isBrowser <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This file exports the libraries we are using as global variables. I know what\nyou are thinking: \"NO! NOT GLOBAL VARIABLES! GLOBAL VARIABLES ARE EVIL!\" The\ntruth of the matter is that when we are testing in multiple environments there\nare different ways to load these dependencies -- we can either do this for\neach test suite or we can do it once up front. Take your pick. This file\nadditionally sets a boolean value <code class=\"language-text\">isBrowser</code> which you can use in the tests\nif you need to test things differently in browsers than you do in Node. You\ncan even set up tests to only run in certain environments by using code like\nthe following:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'multi-environment testing'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isBrowser<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should foo'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// This test will only run in browsers.</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should bar'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// This test will only run in Node.</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'shold baz'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// This test will run everywhere.</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Take a moment to look through the other files included in the project. There\nis no need to walk through them here because after reading this article their\ncontents should be fairly intuitive. That being said, let's do a quick rundown\nof each file. <code class=\"language-text\">lib/num.js</code> contains a basic math library. It has a <code class=\"language-text\">square</code>\nmethod, which squares a given number, and a <code class=\"language-text\">squareRandomNumber</code> method, which\ndepends on a method that asynchronously retrieves a random number.\n<code class=\"language-text\">test/num.test.js</code> tests each of the previously mentioned methods, making use\nof assertions and stubs as necessary.</p>\n<p>Go ahead and run either <code class=\"language-text\">npm test</code> (or <code class=\"language-text\">testem</code> if you installed globally)\nnow.</p>\n<p>Now that Testem is running you'll see a few things. One thing you'll see is a\ntab with the test results for node. Another thing you'll see is a URL you can\nvisit to connect a web browser for testing. After opening the URL in a few web\nbrowsers Testem should look like the following:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/aaf20e22b93549b6cef52f64e0da7a3c/9288f/testem.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.39076376554174%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6UlEQVQoz93SXWuDMBQG4NxNWyI1utXRQhEK263aqo0mJxo/Urfp6P7/f5nO9qLgtu528BBeDjmB5AQ9HU8b+bat3p+b0wqO5CDvk8qipRnLh7RaRLnu81kwDblF59bt9rVzy24tG5sVOAK8F/1qxALHoAf8O0j3GGkTo6TmLic5t1+4KQCHYNdgKzAzMCIxnDUFYVou8gYnaqk+HNlaVJJDYdEvSUHiS56C5nsxD7NBf70d6D67HZr57ErAb4f+tPufNGte2rvz0vEBNY9p5zBUfml2mFqyep014+gcrsbwyJURih/+Zu8TcyR6OgPVL2UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Testem Screenshot\"\n        title=\"Testem Screenshot\"\n        src=\"/static/aaf20e22b93549b6cef52f64e0da7a3c/dbb61/testem.png\"\n        srcset=\"/static/aaf20e22b93549b6cef52f64e0da7a3c/19bd1/testem.png 163w,\n/static/aaf20e22b93549b6cef52f64e0da7a3c/d3bcb/testem.png 325w,\n/static/aaf20e22b93549b6cef52f64e0da7a3c/dbb61/testem.png 650w,\n/static/aaf20e22b93549b6cef52f64e0da7a3c/6b691/testem.png 975w,\n/static/aaf20e22b93549b6cef52f64e0da7a3c/9288f/testem.png 1126w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>By using the left and right arrow keys you can see test results and error\nmessages for all browsers and connected launchers. Pressing <code class=\"language-text\">enter</code> will rerun\ntests in all connected environments, and pressing <code class=\"language-text\">q</code> will quit Testem.</p>\n<p>Try making a change to <code class=\"language-text\">lib/num.js</code> that you think will make one or more of\nthe tests fail. You should see Testem automatically rerun the tests and\nfurther see which tests failed in which environments.</p>\n<h2>Other features in Testem</h2>\n<p>Testem does more than just run tests in multiple environments very easily. You\ncan specify preprocessors that run before tests run (e.g., compiling\nCoffeeScript or running a CSS preprocessor), separate source files (monitored\nfor changes) and served files (not monitored for changes), and more (such as\nthe previously mentioned system notifications). To learn about these features\ntake a look at <a href=\"https://github.com/airportyh/testem\" title=\"Testem\">Testem's documentation</a>.</p>\n<h2>Conclusion</h2>\n<p>This article is meant to get you familiar with the basics of multi-environment\ntesting in JavaScript. More articles about each of the above projects\nfeaturing more advanced features are in the pipeline. In the meantime, you can\nread the official documentation of each project here:</p>\n<ul>\n<li><a href=\"http://visionmedia.github.io/mocha/\" title=\"Mocha\">Mocha</a></li>\n<li><a href=\"http://chaijs.com/\" title=\"Chai\">Chai</a></li>\n<li><a href=\"http://sinonjs.org/\" title=\"Sinon\">Sinon</a></li>\n<li><a href=\"https://github.com/airportyh/testem\" title=\"Testem\">Testem</a></li>\n</ul>","id":"79e41ca8-6372-568e-b14d-d477b962d206","timeToRead":15,"frontmatter":{"date":"December 03, 2013","path":"/blog/testing-in-browsers-and-node","tags":"javascript, testing, node, browser","title":"Testing in Browsers and Node with Mocha, Chai, Sinon, and Testem"}}],"tag":"testing","pagesSum":1,"page":1}}}